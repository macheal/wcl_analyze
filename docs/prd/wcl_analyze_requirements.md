<!--
 * @Author: GUANGYU WANG xinyukc01@hotmail.com
 * @Date: 2025-11-10 11:15:59
 * @LastEditors: GUANGYU WANG xinyukc01@hotmail.com
 * @LastEditTime: 2025-11-13 11:49:04
 * @FilePath: /wcl_analyze/docs/prd/wcl_analyze_requirements.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# WCL战斗日志分析系统 - 产品需求文档

## 项目背景

WCL (Warcraft Logs) 是一个魔兽世界战斗日志分析平台，本项目旨在为WCL战斗日志提供一个可视化的查询和分析界面，帮助玩家和团队更好地分析战斗数据，提升游戏表现。

## 项目定位与愿景

### 核心定位
开发一套**团队失误分析系统**，通过对战斗数据的采集与分析，实现对团队整体失误情况的量化评估，精准定位每位团队成员的技能薄弱环节，并建立可视化的个人成长曲线追踪系统，直观展示成员能力提升轨迹。

### 长期愿景
构建魔兽世界最专业的团队失误分析平台，为公会团队提供科学的数据分析工具，帮助团队持续优化战斗表现，成为团长和指挥的必备工具。

## 项目目标

### 一期目标（当前阶段）
构建用户友好的Web前端界面，提供以下核心功能：
1. 战斗报告查询入口
2. Boss选择和管理
3. 技能命中分析
4. 节点之王萨哈达尔-誓言约束（万相拳）专项分析
5. 数据可视化图表展示

### 二期及后续目标（功能迭代规划）
逐步扩展以下高级分析功能模块：
- 场均失误统计分析模块
- MVP评选系统
- 多维度战斗日志分析
- 公会赛季分析功能
- 死亡技能专项分析
- 重点技能深度分析

## 一期开发范围界定

### 核心战斗场景聚焦
系统首期功能开发将聚焦于特定战斗场景，具体包括：

#### 主要分析目标
- **节点之王萨哈达尔 (Boss ID: 649)**
- **誓言约束技能 (万相拳)** - 核心分析技能
- **其他所有可被玩家接收的技能** - 全面数据采集

#### 分析维度
1. **技能命中分析**: 所有技能的命中情况统计
2. **万相拳专项分析**: 
   - 分人失误统计
   - 分场次失误分析
   - 分阶段详细追踪
3. **失误模式识别**: 识别常见的失误类型和原因
4. **个人表现追踪**: 建立个人失误档案和成长曲线

#### 数据指标
- 失误次数统计（个人/团队）
- 失误率计算
- 失误趋势分析
- 技能薄弱环节识别
- 成长曲线可视化
- 希望通过数据分析提升团队整体表现

## 用户画像

**主要用户群体：**
- 魔兽世界团队副本团长和指挥
- 团队分析师和数据爱好者
- 个人玩家寻求提升表现

**用户特征：**
- 熟悉WCL平台的基本使用
- 需要快速查看特定战斗数据
- 关注技能命中和伤害统计
- 需要直观的数据展示方式

## 系统架构

### 前端技术栈
- **框架**: React 18.3.1 + TypeScript
- **构建工具**: Vite 6.2.0
- **UI组件**: 自定义组件 + Tailwind CSS
- **图表库**: ECharts + echarts-for-react
- **状态管理**: React Hooks (useState, useEffect, useMemo, useCallback)
- **路由**: 基于URL hash的参数管理

### 部署架构
- **Web服务器**: Nginx
- **静态资源**: 本地部署
- **API代理**: Nginx反向代理到后端服务
- **支持环境**: 开发环境 + 生产环境

## 功能列表

### 1. 报告ID输入功能
- **描述**: 页面加载时弹出模态框，要求用户输入WCL报告ID
- **输入要求**: 支持标准的WCL报告ID格式（如：tTAM3BKp9Yjd7RHr）
- **验证**: 基本的格式验证，确保输入不为空
- **用户体验**: 
  - 提供示例和错误提示
  - 支持URL参数自动填充（#reportId=xxx）
  - 提供演示图片指导用户如何获取报告ID
- **默认示例**: 提供默认报告ID便于测试

### 2. Boss选择功能
- **描述**: 根据输入的报告ID，获取并显示可用的Boss列表
- **数据来源**: 调用 `/api/v2/code/get_wcl_boss_by_report_id` 接口
- **交互方式**: 下拉选择框
- **显示内容**: Boss名称、ID、击杀状态
- **智能切换**: 当选择卡雷苟斯（ID: 3134）时自动显示万相拳分析Tab

### 3. Tab页切换功能
- **描述**: 提供两个主要的分析tab页，智能显示基于选择的Boss
- **Tab 1 - 技能命中查询**:
  - 显示技能列表（调用 `/api/v2/code/get_wcl_damage_taken_abilities_by_boss_id`）
  - 支持按技能筛选和查询详细命中数据（调用 `/api/v2/code/boss_skill_hit_list`）
  - 展示技能命中统计表格
  - 支持数据刷新功能
  
- **Tab 2 - 卡雷苟斯M7万相拳统计**（仅当选择卡雷苟斯时显示）:
  - 分人统计（调用 `/api/v2/code/boss_kls_M7_wxq`）
  - 分场次统计（调用 `/api/v2/code/boss_kls_M7_wxq_list`）
  - 分阶段详细统计（调用 `/api/v2/code/boss_kls_M7_wxq_detail`）
  - 图表化展示数据分布

### 4. 数据展示功能

#### 表格展示
- **通用数据表格组件**: 支持自定义列、排序、多行文本显示
- **排序功能**: 支持单列排序（升序/降序）
- **数据格式化**: 数字千分位格式化，0值隐藏处理
- **加载状态**: 骨架屏加载动画
- **空数据处理**: 友好的无数据提示

#### 万相拳统计分析（团队失误分析核心）
- **玩家维度统计**:
  - 玩家名称、失误次数
  - 分阶段失误统计（第一次、第二次、第三次）
  - 支持按任意列排序
  - **失误率计算**: 失误次数/总参与场次
  - **成长趋势**: 基于历史数据的进步轨迹
  
- **分场次统计**:
  - 场次ID（支持链接到WCL详情页）
  - Boss血量阶段、战斗用时
  - 各阶段失误玩家列表
  - 支持按任意列排序
  - **团队失误率**: 单场团队整体失误表现
  - **失误集中时段**: 识别失误高发时间段

#### 失误分析维度
- **个人失误档案**: 建立每位成员的技能失误记录
- **团队失误热力图**: 可视化展示团队整体失误分布
- **薄弱环节识别**: 自动识别每位成员的易错技能
- **改进建议生成**: 基于数据提供个性化改进建议

### 5. 数据可视化功能

#### 饼图分析
- **玩家维度失误统计饼图**:
  - 显示各玩家失误次数占比
  - 支持下钻到具体玩家的阶段分布
  - 随机颜色生成，支持返回上级
  
- **失误次数维度统计饼图**:
  - 显示第一次、第二次、第三次失误占比
  - 支持下钻到具体阶段的玩家分布
  - 固定配色方案，支持返回上级

#### 图表交互
- **点击下钻**: 点击图表元素进入详细视图
- **返回功能**: 支持下钻后的返回操作
- **动画效果**: 弹性动画和缩放效果
- **响应式**: 自适应不同屏幕尺寸

### 6. 用户体验优化

#### 界面设计
- **暗黑主题**: 灰色系配色方案，适合长时间查看
- **响应式布局**: 支持桌面端和移动端访问
- **加载状态**: 多种加载动画（Spinner、骨架屏）
- **错误处理**: 友好的错误提示和重试机制

#### 交互优化
- **URL参数支持**: 支持通过URL hash传递报告ID
- **状态保持**: 页面刷新后保持当前选择状态
- **一键重置**: 支持重置所有选择回到初始状态
- **实时更新**: 支持数据实时刷新

#### 辅助功能
- **键盘导航**: 支持Tab键导航
- **屏幕阅读器**: ARIA标签支持
- **高对比度**: 良好的颜色对比度

## 非功能性要求

### 性能要求
- 页面加载时间 < 2秒
- API响应时间 < 3秒
- 支持并发用户 > 50人
- 静态资源缓存优化

### 兼容性要求
- **浏览器支持**: Chrome, Firefox, Safari, Edge (最新版本)
- **移动端**: 支持主流移动设备
- **分辨率**: 支持320px - 4K分辨率

### 用户体验要求
- 界面简洁直观，符合现代Web设计标准
- 提供加载状态和错误处理
- 响应式设计，支持移动端访问
- 支持键盘快捷键操作

### 技术规范
- **代码质量**: TypeScript强类型，ESLint代码规范
- **组件化**: 模块化组件设计，高内聚低耦合
- **性能优化**: React.memo, useMemo, useCallback优化
- **错误边界**: 组件级错误处理

### 安全要求
- 输入验证和消毒处理
- HTTPS协议传输
- 防止XSS和CSRF攻击
- API请求头安全配置

### 可维护性
- **代码注释**: 关键逻辑和复杂算法注释
- **文档完整**: 详细的README和部署文档
- **版本管理**: Git版本控制，合理的提交历史
- **测试覆盖**: 核心功能测试用例

## 接口依赖

项目依赖以下后端API接口：
- `POST /api/v2/code/get_wcl_boss_by_report_id` - 获取Boss列表
- `POST /api/v2/code/get_wcl_damage_taken_abilities_by_boss_id` - 获取技能列表
- `POST /api/v2/code/boss_skill_hit_list` - 获取技能命中详情
- `POST /api/v2/code/boss_kls_M7_wxq` - 卡雷苟斯M7万相拳分人统计
- `POST /api/v2/code/boss_kls_M7_wxq_list` - 卡雷苟斯M7万相拳分场次统计
- `POST /api/v2/code/boss_kls_M7_wxq_detail` - 卡雷苟斯M7万相拳分阶段详细统计

## 部署方案

### 开发环境
- **本地开发**: `npm run dev` 启动开发服务器
- **端口**: 默认3000端口
- **热更新**: 支持模块热替换
- **API代理**: 自动代理到配置的后端服务

### 生产环境
- **静态构建**: `npm run build` 生成静态文件
- **Nginx部署**: 一键部署脚本 `deploy-nginx.sh`
- **配置优化**: Gzip压缩、静态缓存、安全头配置
- **监控日志**: 访问日志和错误日志分离

### 部署文件结构
```
deploy/
├── nginx.conf          # Nginx配置文件
├── deploy-nginx.sh     # 一键部署脚本
└── DEPLOYMENT-NGINX.md # 部署说明文档
```

## 项目交付物

1. **完整的前端Web应用**
   - React + TypeScript源码
   - 组件库和工具函数
   - 类型定义和接口规范

2. **项目文档和使用说明**
   - 开发环境搭建指南
   - 功能使用说明
   - API接口文档

3. **部署脚本和配置文件**
   - Nginx配置模板
   - 一键部署脚本
   - 环境配置说明

4. **测试用例和测试报告**
   - 核心功能测试用例
   - 兼容性测试报告
   - 性能测试数据

## 扩展功能规划

### 二期功能模块（近期开发）

#### 1. 场均失误统计分析模块
- **计算指标**:
  - 团队平均每场战斗失误次数
  - 个人平均每场战斗失误次数
  - 失误率计算公式: (失误次数/总参与场次) × 100%
- **趋势分析**:
  - 跨天失误趋势图表
  - 个人失误稳定性评估
  - 团队失误改善曲线

#### 2. MVP评选系统
- **评选标准**:
  - 基于失误率最低原则
  - 综合参与度评估
  - 进步幅度考量
- **展示形式**:
  - 单场MVP标识
  - 周度/月度MVP榜单
  - 历史MVP记录追踪

#### 3. 多维度战斗日志分析
- **时间维度**:
  - 跨天战斗数据整合
  - 跨周战斗趋势分析
  - 月度表现对比
- **模式识别**:
  - 长期失误模式识别
  - 周期性失误规律发现
  - 环境因素对失误的影响分析

### 三期功能模块（中期规划）

#### 4. 公会赛季分析功能
- **赛季统计**:
  - 整个公会赛季的战斗数据汇总
  - 团队整体表现趋势
  - 赛季进步幅度量化
- **对比分析**:
  - 不同赛季表现对比
  - 团队间表现排名
  - 赛季目标达成度评估

#### 5. 死亡技能专项分析
- **死亡关联分析**:
  - 导致团队成员死亡的技能类型追踪
  - 死亡频率统计
  - 死亡与失误的关联因素分析
- **预警机制**:
  - 高风险死亡技能预警
  - 死亡趋势预测
  - 防范建议生成

#### 6. 重点技能深度分析
- **专项建模**:
  - 针对特定高价值技能建立分析模型
  - 精细化的失误判定标准
  - 个性化的优化建议
- **技能库建设**:
  - 建立重点技能数据库
  - 技能难度系数评估
  - 技能掌握度追踪

### 长期规划（6个月以上）
- 用户账户系统与数据持久化
- 机器学习预测分析
- 智能教练系统
- 社区功能（分享、对比、竞赛）
- 移动端原生应用开发
- 多语言国际化支持

